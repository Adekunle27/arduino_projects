#include <ESP8266WiFi.h>
#include <IRremoteESP8266.h>
#include <IRsend.h>

const char *ssid = "TP-Link_58E5";
const char *password = "97001515";

const uint16_t kIrLed = 14; // ESP8266 GPIO pin to use. Recommended: 4 (D2).

IRsend irsend(kIrLed); // Set the GPIO to be used to sending the message.

// Hisense Power on | of

uint16_t HisenseAC_power[343] = {9046, 4426,  522, 1722,  494, 1752,  494, 632,  496, 606,  468, 640,  496, 614,  468, 646,  494, 1730,  496, 624,  494, 1724,  496, 1754,  496, 634,  496, 610,  468, 642,  496, 618,  494, 608,  496, 596,  524, 572,  494, 1730,  518, 610,  468, 638,  522, 588,  494, 620,  494, 608,  466, 626,  468, 1752,  520, 606,  494, 608,  492, 1738,  494, 644,  466, 646,  496, 1730,  496, 624,  466, 630,  494, 606,  468, 634,  496, 612,  522, 588,  496, 618,  468, 634,  494, 598,  496, 602,  524, 576,  496, 608,  494, 612,  494, 618,  494, 618,  496, 594,  494, 8022,  520, 1722,  496, 628,  468, 632,  494, 1730,  522, 614,  496, 614,  496, 616,  496, 1730,  494, 626,  496, 600,  520, 1702,  496, 1760,  522, 612,  468, 1764,  498, 644,  496, 606,  522, 570,  496, 600,  524, 576,  496, 606,  526, 580,  520, 590,  522, 592,  496, 606,  496, 596,  494, 602,  494, 604,  468, 636,  494, 612,  496, 614,  494, 620,  496, 606,  520, 574,  468, 628,  496, 604,  496, 608,  468, 640,  496, 616,  466, 646,  496, 606,  496, 596,  496, 600,  496, 604,  468, 634,  496, 610,  494, 616,  494, 620,  494, 608,  498, 596,  496, 600,  522, 578,  472, 632,  496, 610,  522, 588,  496, 618,  478, 622,  496, 1720,  494, 1752,  522, 604,  520, 582,  496, 1734,  522, 1738,  496, 646,  520, 570,  496, 8022,  520, 600,  496, 600,  496, 604,  468, 634,  522, 586,  496, 614,  522, 592,  496, 604,  524, 1692,  524, 600,  468, 632,  468, 636,  496, 610,  468, 642,  498, 616,  496, 608,  494, 598,  524, 572,  522, 578,  496, 606,  468, 638,  526, 584,  468, 646,  498, 604,  524, 568,  522, 574,  496, 604,  526, 580,  494, 610,  522, 588,  524, 590,  496, 606,  468, 624,  468, 628,  524, 576,  524, 1702,  496, 640,  496, 614,  496, 618,  522, 580,  494, 598,  552, 544,  524, 576,  522, 580,  496, 610,  526, 584,  470, 644,  496, 604,  468, 1748,  496, 628,  520, 578,  494, 1732,  496, 638,  468, 642,  496, 618,  470, 620,  524}; // KELON 92040683

// Hisense Temp Up
uint16_t HisenseAC_tempUp[343] = {8988, 4462, 494, 1748, 470, 1778, 468, 656, 444, 658, 472, 634, 446,
                                 664, 470, 644, 444, 1784, 496, 620, 444, 1778, 468, 1782, 494, 632, 
                                 444, 664, 444, 666, 444, 670, 444, 658, 444, 648, 472, 626, 444, 654, 
                                 446, 658, 444, 662, 446, 666, 444, 668, 446, 658, 444, 648, 446, 1778, 
                                 468, 654, 446, 658, 444, 662, 444, 1794, 466, 670, 444, 1808, 446, 648, 
                                 446, 650, 446, 654, 466, 636, 446, 660, 446, 666, 444, 670, 446, 656, 444, 
                                 648, 446, 650, 468, 634, 444, 658, 446, 662, 444, 664, 446, 668, 446, 644, 
                                 490, 8032, 468, 1776, 468, 652, 444, 654, 468, 1764, 468, 662, 444, 666, 444, 
                                 668, 444, 1786, 466, 648, 444, 652, 444, 1804, 446, 1786, 466, 662, 444, 1792, 
                                 490, 648, 466, 636, 444, 648, 444, 652, 488, 612, 446, 658, 446, 662, 468, 642, 
                                 446, 668, 466, 636, 466, 626, 446, 652, 466, 634, 514, 588, 444, 662, 488, 622, 
                                 446, 668, 466, 634, 488, 604, 446, 652, 516, 584, 466, 638, 466, 640, 488, 622, 
                                 466, 648, 446, 656, 444, 648, 444, 652, 466, 632, 446, 658, 466, 640, 516, 594, 
                                 446, 668, 444, 658, 444, 648, 488, 608, 466, 634, 516, 588, 514, 592, 518, 592, 
                                 444, 668, 516, 586, 490, 1754, 466, 1758, 468, 1782, 538, 588, 446, 662, 514, 
                                 596, 518, 596, 514, 576, 490, 8032, 466, 648, 466, 630, 516, 584, 490, 614, 
                                 488, 618, 518, 592, 488, 624, 518, 586, 518, 574, 488, 1734, 512, 612, 488, 
                                 616, 516, 590, 516, 594, 466, 648, 488, 614, 514, 578, 514, 582, 516, 584, 516, 
                                 588, 468, 640, 514, 596, 490, 624, 490, 612, 486, 608, 516, 580, 466, 634, 516, 
                                 586, 490, 618, 514, 596, 488, 628, 490, 612, 444, 648, 518, 578, 514, 586, 444, 
                                 1786, 544, 586, 466, 644, 446, 668, 446, 656, 446, 648, 514, 582, 502, 598, 466, 
                                 636, 490, 618, 516, 594, 446, 668, 446, 656, 444, 648, 446, 1778, 468, 654, 466, 
                                 1788, 446, 662, 444, 666, 444, 668, 446, 644, 516};  // KELON A2000683;


// Hisense Temp Down
uint16_t HisenseAC_tempDown[343] = {9026, 4424, 550, 1692, 550, 1720, 528, 572, 528, 576, 500, 606, 528, 584, 502, 
                                    610, 528, 1724, 502, 590, 528, 1718, 528, 1700, 550, 576, 502, 604, 530, 580, 
                                    530, 584, 526, 576, 524, 568, 526, 568, 528, 572, 500, 602, 526, 580, 528, 582,
                                    500, 614, 528, 574, 526, 566, 528, 1696, 550, 574, 528, 574, 530, 1726, 528, 584, 
                                    526, 586, 528, 1722, 528, 566, 528, 568, 530, 570, 528, 576, 526, 580, 502, 608, 
                                    530, 584, 528, 574, 528, 564, 530, 568, 526, 572, 528, 576, 500, 606, 528, 582, 
                                    528, 586, 528, 562, 500, 8042, 530, 1692, 550, 568, 528, 572, 528, 1704, 550, 580, 
                                    526, 584, 526, 586, 528, 1702, 554, 562, 528, 568, 526, 1722, 528, 1726, 502, 606, 
                                    526, 1734, 528, 588, 502, 600, 526, 566, 528, 568, 500, 600, 526, 576, 528, 580, 
                                    526, 584, 526, 588, 502, 600, 528, 566, 526, 570, 526, 574, 500, 602, 528, 580,
                                    530, 580, 528, 588, 526, 576, 526, 566, 528, 568, 530, 570, 502, 602, 502, 606, 
                                    500, 610, 502, 612, 526, 576, 526, 566, 528, 568, 526, 572, 528, 574, 528, 580, 
                                    526, 584, 528, 586, 502, 600, 528, 564, 528, 568, 528, 572, 530, 574, 526, 578, 
                                    528, 584, 526, 586, 528, 574, 528, 1690, 526, 1744, 528, 1702, 552, 572, 526,
                                    1730, 530, 1730, 532, 584, 502, 588, 502, 8040, 528, 566, 530, 566, 528, 572, 
                                    528, 576, 524, 582, 528, 582, 502, 614, 502, 600, 528, 564, 526, 1718, 528, 574,
                                    528, 576, 526, 580, 502, 608, 528, 586, 530, 572, 530, 564, 526, 570, 530, 570, 528,
                                    574, 528, 580, 528, 582, 528, 586, 530, 572, 524, 568, 502, 594, 526, 574, 526, 576, 
                                    526, 582, 526, 584, 530, 584, 500, 600, 528, 566, 528, 568, 528, 570, 528, 1724, 528, 
                                    582, 500, 610, 528, 586, 526, 576, 526, 566, 526, 570, 526, 574, 526, 576, 528, 578, 
                                    502, 608, 526, 588, 530, 572, 526, 566, 528, 1716, 528, 572, 502, 1750, 530, 578, 
                                    528, 582, 526, 588, 528, 562, 560};  // KELON 92000683;

// Hisense Fan
uint16_t HisenseAC_fan[343] = {9008, 4468, 468, 1774, 542, 1708, 538, 582, 518, 586, 520, 586, 516, 594, 516, 
                                    598, 514, 1714, 540, 576, 490, 1732, 544, 1708, 538, 588, 520, 586, 514, 596, 
                                    516, 596, 516, 586, 520, 1698, 546, 574, 514, 586, 516, 586, 514, 592, 490, 620, 
                                    446, 668, 444, 658, 486, 606, 444, 1778, 468, 654, 446, 658, 466, 1768, 468, 664, 
                                    446, 668, 514, 1714, 540, 576, 444, 652, 488, 610, 514, 588, 446, 662, 466, 644,
                                     518, 596, 488, 612, 466, 628, 466, 630, 466, 632, 446, 658, 446, 662, 514, 598, 
                                     466, 648, 444, 644, 466, 8054, 542, 1724, 446, 652, 444, 654, 444, 1786, 510, 
                                     618, 516, 594, 514, 600, 488, 1744, 466, 646, 446, 650, 466, 1760, 512, 1742, 
                                     468, 660, 490, 1748, 540, 598, 466, 636, 444, 648, 446, 650, 466, 634, 466, 
                                     638, 444, 662, 488, 622, 446, 668, 444, 658, 514, 578, 466, 630, 446, 654, 
                                     446, 658, 444, 662, 444, 666, 514, 600, 488, 614, 446, 648, 514, 582, 486, 614,
                                      488, 616, 444, 662, 468, 642, 466, 648, 444, 658, 514, 580, 488, 608, 446, 654,
                                       466, 636, 516, 590, 516, 594, 516, 596, 444, 658, 466, 626, 468, 630, 444, 654,
                                        488, 614, 466, 640, 446, 664, 446, 668, 446, 656, 446, 646, 446, 1778, 468,
                                        1782, 466, 660, 444, 1788, 496, 1786, 446, 668, 474, 616, 470, 8048, 498, 620, 
                                        474, 622, 474, 626, 474, 628, 474, 632, 474, 636, 474, 640, 474, 628, 474, 1746,
                                         496, 622, 472, 628, 474, 628, 474, 1762, 496, 638, 472, 640, 472, 630, 472, 620, 
                                         474, 624, 472, 628, 472, 630, 472, 634, 472, 638, 472, 640, 472, 630, 472, 620, 
                                         472, 624, 472, 628, 472, 630, 474, 632, 474, 636, 474, 640, 474, 628, 474, 618, 
                                         474, 622, 474, 624, 474, 1756, 496, 634, 472, 638, 446, 668, 446, 658, 444, 648, 
                                         446, 650, 446, 654, 446, 658, 444, 662, 444, 664, 468, 646, 446, 654, 466, 1754, 
                                         544, 576, 446, 654, 446, 1786, 494, 1762, 496, 636, 514, 600, 444, 644, 466};  // KELON 92010683;

// Hisense Mode
uint16_t HisenseAC_mode[343] = {8990, 4490, 580, 568, 550, 548, 576, 568, 550, 1672,
                               574, 1678, 578, 568, 556, 566, 554, 1668, 554, 1698,
                               604, 1644, 556, 1698, 574, 1672, 578, 568, 554, 1670,
                               580, 1668, 582, 566, 530, 592, 552, 568, 528, 594,
                               554, 1672, 576, 570, 526, 594, 552, 570, 530, 592,
                               528, 1694, 582, 1668, 578, 1670, 582, 564, 554, 1670,
                               584, 1666, 578, 1668, 556, 1698, 576, 42414, 8992, 2256,
                               580, 43920, 100};

WiFiServer wifiServer(80);

void setup()
{
  irsend.begin();
  Serial.begin(115200);

  delay(1000);

  WiFi.begin(ssid, password);
  Serial.println(WiFi.status());

  while (WiFi.status() != WL_CONNECTED)
  {
    delay(1000);
    Serial.println("Connecting..");
  }

  Serial.print("Connected to WiFi. IP:");
  Serial.println(WiFi.localIP());

  wifiServer.begin();
}

void loop()
{

  WiFiClient client = wifiServer.available();
  String command = "";

  if (client)
  {
   Serial.println("Client connected");
   client.write("Client connected");

    while (client.connected())
    {

      while (client.available() > 0)
      {
        char c = client.read();
        if (c == '\n')
        {
          break;
        }
        command += c;
        Serial.write(c);
        client.write(c);
      }

      if (command == "POWER")
      {
        irsend.sendRaw(HisenseAC_power, 343, 38); // Send a raw data capture at 38kHz.
        Serial.println("We got the power !!");
         client.write("We got the power !!");
      }
      else if (command == "TEMPUP")
      {
        irsend.sendRaw(HisenseAC_tempUp, 343, 38); // Send a raw data capture at 38kHz.
        Serial.println("We got the power !!");
      }
      else if (command == "TEMPDOWN")
      {
        irsend.sendRaw(HisenseAC_tempDown, 343, 38); // Send a raw data capture at 38kHz.
        Serial.println("We got the power !!");
      }
      else if (command == "FAN")
      {
        irsend.sendRaw(HisenseAC_fan, 343, 38); // Send a raw data capture at 38kHz.
        Serial.println("We got the power !!");
      }
      else if (command == "MODE")
      {
        irsend.sendRaw(HisenseAC_mode, 73, 38); // Send a raw data capture at 38kHz.
        Serial.println("We got the power !!");
      }

      command = "";
      delay(10);
    }

    client.stop();
    Serial.println("Client disconnected");
  }
}
